<!DOCTYPE html>
<html lang="en" data-theme="dark" style="background:#0d1117">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, viewport-fit=cover">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-eval'; img-src 'self' data: file: https:; font-src 'self' data:;">
  <title>MD Viewer</title>
  <link rel="stylesheet" href="./styles/main.css">
  <link rel="stylesheet" href="./styles/menu.css">
  <link rel="stylesheet" href="./styles/markdown.css">
  <link rel="stylesheet" href="./styles/mermaid.css">
  <link rel="stylesheet" href="./styles/dialogs.css">
  <link rel="stylesheet" href="./styles/editor.css">
  <link rel="stylesheet" href="./styles/mobile.css">
  <link rel="stylesheet" href="./styles/themes/dark.css">
</head>
<body>
  <!-- Menu Bar -->
  <nav id="menu-bar">
    <div class="menu-item">
      <button class="menu-button" aria-haspopup="true" aria-expanded="false">File</button>
      <ul class="menu-dropdown" role="menu">
        <li role="menuitem">
          <button id="menu-open-local" class="menu-action">
            <span>Open Local File</span>
            <span class="menu-shortcut">Ctrl+O</span>
          </button>
        </li>
        <li role="menuitem" class="electron-only">
          <button id="menu-open-remote" class="menu-action">
            <span>Open Remote File</span>
            <span class="menu-shortcut">Ctrl+Shift+O</span>
          </button>
        </li>
        <li role="separator" class="menu-separator"></li>
        <li role="menuitem">
          <button id="menu-reload" class="menu-action" disabled>
            <span>Reload</span>
            <span class="menu-shortcut">Ctrl+R</span>
          </button>
        </li>
        <li role="menuitem">
          <button id="menu-close" class="menu-action" disabled>
            <span>Close/Disconnect</span>
          </button>
        </li>
        <li role="separator" class="menu-separator"></li>
        <li role="menuitem">
          <button id="menu-settings" class="menu-action">
            <span>Settings</span>
          </button>
        </li>
      </ul>
    </div>
    <div class="menu-item">
      <button class="menu-button" aria-haspopup="true" aria-expanded="false">View</button>
      <ul class="menu-dropdown" role="menu">
        <li role="menuitem">
          <button id="menu-zoom-in" class="menu-action">
            <span>Zoom In</span>
            <span class="menu-shortcut">Ctrl++</span>
          </button>
        </li>
        <li role="menuitem">
          <button id="menu-zoom-out" class="menu-action">
            <span>Zoom Out</span>
            <span class="menu-shortcut">Ctrl+-</span>
          </button>
        </li>
        <li role="menuitem">
          <button id="menu-zoom-reset" class="menu-action">
            <span>Reset Zoom</span>
            <span class="menu-shortcut">Ctrl+0</span>
          </button>
        </li>
        <li role="separator" class="menu-separator"></li>
        <li role="menuitem">
          <button id="menu-toggle-theme" class="menu-action">
            <span>Toggle Theme</span>
            <span class="menu-shortcut">Ctrl+Shift+T</span>
          </button>
        </li>
        <li role="menuitem">
          <button id="menu-fullscreen" class="menu-action">
            <span>Toggle Fullscreen</span>
            <span class="menu-shortcut">F11</span>
          </button>
        </li>
      </ul>
    </div>
    <div class="menu-item">
      <button class="menu-button" aria-haspopup="true" aria-expanded="false">Help</button>
      <ul class="menu-dropdown" role="menu">
        <li role="menuitem">
          <button id="menu-shortcuts" class="menu-action">
            <span>Keyboard Shortcuts</span>
          </button>
        </li>
        <li role="menuitem">
          <button id="menu-about" class="menu-action">
            <span>About</span>
          </button>
        </li>
      </ul>
    </div>
  </nav>
  <!-- Hidden file input for web mode -->
  <input type="file" id="file-input" accept=".md,.markdown" style="display:none">

  <div id="app">
    <!-- Loading overlay -->
    <div id="loading-overlay" class="hidden">
      <div class="loading-spinner"></div>
      <p class="loading-message">Loading...</p>
    </div>

    <!-- Toast notifications -->
    <div id="toast-container"></div>

    <!-- Error banner -->
    <div id="error-banner" class="hidden">
      <span class="error-message"></span>
      <button class="error-dismiss" aria-label="Dismiss">&times;</button>
    </div>

    <!-- Connection status banner -->
    <div id="connection-banner" class="hidden">
      <span class="connection-message"></span>
      <button class="connection-retry">Retry</button>
      <button class="connection-dismiss" aria-label="Dismiss">&times;</button>
    </div>

    <!-- Empty state -->
    <div id="empty-state">
      <div class="empty-header">
        <div class="empty-icon">ðŸ“„</div>
        <h2>Drag a markdown file here</h2>
        <p id="shortcut-hint">or press <kbd>Ctrl</kbd>+<kbd>O</kbd> to open</p>
      </div>

      <div class="files-sections">
        <div class="docs-files" id="docs-section">
          <h3>Docs Folder</h3>
          <ul id="docs-files-list"></ul>
        </div>
        <div class="recent-files" id="recent-section">
          <h3>Recent Files</h3>
          <ul id="recent-files-list"></ul>
        </div>
      </div>
    </div>

    <!-- Main content -->
    <main id="content" class="hidden">
      <!-- Floating action buttons -->
      <div class="floating-actions" id="floating-actions">
        <button class="floating-btn" id="btn-edit" title="Edit (Ctrl+E)" aria-label="Edit file">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
          </svg>
        </button>
      </div>
      
      <!-- View pane (default) -->
      <div class="view-pane" id="view-pane">
        <article id="markdown-content"></article>
      </div>
      
      <!-- Edit overlay (hidden by default) -->
      <div class="edit-overlay hidden" id="edit-overlay">
        <div class="edit-header">
          <div class="edit-title">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
            <span>Editing</span>
          </div>
          <div class="edit-actions">
            <button class="edit-action-btn" id="btn-split" title="Split view">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="12" y1="3" x2="12" y2="21"></line>
              </svg>
            </button>
            <button class="edit-action-btn primary" id="btn-save" title="Save (Ctrl+S)">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                <polyline points="7 3 7 8 15 8"></polyline>
              </svg>
              <span>Save</span>
            </button>
            <button class="edit-action-btn" id="btn-close-edit" title="Close (Esc)">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
        </div>
        <div class="edit-content">
          <div class="edit-editor" id="editor-container"></div>
          <div class="edit-preview hidden" id="edit-preview">
            <article id="preview-content"></article>
          </div>
        </div>
      </div>
    </main>

    <!-- Dialogs -->
    <dialog id="remote-dialog" class="modal">
      <form method="dialog">
        <h3>Open Remote File</h3>
        <div class="form-row">
          <div class="form-group">
            <label for="remote-protocol">Protocol</label>
            <select id="remote-protocol">
              <option value="ssh">SSH/SFTP</option>
              <option value="smb">SMB/CIFS</option>
              <option value="nfs">NFS</option>
            </select>
          </div>
          <div class="form-group flex-grow">
            <label for="remote-host">Host</label>
            <input type="text" id="remote-host" placeholder="server.example.com" required>
          </div>
          <div class="form-group">
            <label for="remote-port">Port</label>
            <input type="number" id="remote-port" value="22" min="1" max="65535">
          </div>
        </div>
        <div class="form-group">
          <label for="remote-path">Path</label>
          <input type="text" id="remote-path" placeholder="/home/user/docs" required>
        </div>
        <div class="form-group" id="smb-share-group" style="display: none;">
          <label for="smb-share">Share Name</label>
          <input type="text" id="smb-share" placeholder="documents">
        </div>
        <div class="file-browser hidden" id="remote-file-browser">
          <div class="browser-toolbar">
            <button type="button" id="browser-up" class="icon-btn" title="Go up">â¬†</button>
            <span id="browser-path">/</span>
            <button type="button" id="browser-refresh" class="icon-btn" title="Refresh">ðŸ”„</button>
          </div>
          <ul id="browser-list" class="file-list"></ul>
        </div>
        <div class="recent-connections" id="recent-connections">
          <h4>Recent Connections</h4>
          <ul id="recent-connections-list"></ul>
        </div>
        <div class="dialog-actions">
          <button type="button" class="btn-secondary" id="remote-cancel">Cancel</button>
          <button type="button" class="btn-secondary" id="remote-connect">Connect</button>
          <button type="submit" class="btn-primary" id="remote-open" disabled>Open</button>
        </div>
      </form>
    </dialog>

    <dialog id="credentials-dialog" class="modal">
      <form method="dialog">
        <h3>Authentication Required</h3>
        <p class="connection-info">
          Connect to <strong id="cred-host"></strong> via <span id="cred-protocol"></span>
        </p>
        <div class="form-group">
          <label for="cred-username">Username</label>
          <input type="text" id="cred-username" required autocomplete="username">
        </div>
        <div class="form-group">
          <label for="cred-password">Password</label>
          <input type="password" id="cred-password" autocomplete="current-password">
        </div>
        <div class="form-group" id="ssh-key-group" style="display: none;">
          <label for="cred-keyfile">SSH Private Key (optional)</label>
          <input type="file" id="cred-keyfile" accept=".pem,.ppk,.key,id_rsa,id_ed25519">
          <small>Leave empty to use password authentication</small>
        </div>
        <div class="form-group" id="smb-domain-group" style="display: none;">
          <label for="cred-domain">Domain</label>
          <input type="text" id="cred-domain" placeholder="WORKGROUP">
        </div>
        <div class="form-group checkbox">
          <input type="checkbox" id="cred-remember">
          <label for="cred-remember">Remember credentials (encrypted)</label>
        </div>
        <div class="dialog-actions">
          <button type="button" class="btn-secondary" id="cred-cancel">Cancel</button>
          <button type="submit" class="btn-primary">Connect</button>
        </div>
      </form>
    </dialog>

    <dialog id="shortcuts-dialog" class="modal">
      <h3>Keyboard Shortcuts</h3>
      <table class="shortcuts-table">
        <tbody>
          <tr id="shortcut-ctrl-o"><td><kbd>Ctrl</kbd>+<kbd>O</kbd></td><td>Open local file</td></tr>
          <tr><td><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>O</kbd></td><td>Open remote file</td></tr>
          <tr><td><kbd>Ctrl</kbd>+<kbd>E</kbd></td><td>Edit file</td></tr>
          <tr><td><kbd>Ctrl</kbd>+<kbd>S</kbd></td><td>Save file</td></tr>
          <tr><td><kbd>Ctrl</kbd>+<kbd>R</kbd></td><td>Reload file</td></tr>
          <tr><td><kbd>Ctrl</kbd>+<kbd>W</kbd></td><td>Close window</td></tr>
          <tr><td><kbd>Ctrl</kbd>+<kbd>+</kbd></td><td>Zoom in</td></tr>
          <tr><td><kbd>Ctrl</kbd>+<kbd>-</kbd></td><td>Zoom out</td></tr>
          <tr><td><kbd>Ctrl</kbd>+<kbd>0</kbd></td><td>Reset zoom</td></tr>
          <tr><td><kbd>Ctrl</kbd>+<kbd>F</kbd></td><td>Find in document</td></tr>
          <tr><td><kbd>Ctrl</kbd>+<kbd>Z</kbd></td><td>Undo (in editor)</td></tr>
          <tr><td><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>Z</kbd></td><td>Redo (in editor)</td></tr>
          <tr><td><kbd>F11</kbd></td><td>Toggle fullscreen</td></tr>
          <tr id="shortcut-home"><td><kbd>Esc</kbd></td><td>Close editor/dialog</td></tr>
        </tbody>
      </table>
      <div class="dialog-actions">
        <button type="button" class="btn-primary" id="shortcuts-close">Close</button>
      </div>
    </dialog>

    <dialog id="about-dialog" class="modal">
      <h3>MD Viewer</h3>
      <p>Version 1.0.0</p>
      <p>A minimalist markdown file viewer and editor with support for:</p>
      <ul>
        <li>GitHub Flavored Markdown</li>
        <li>Mermaid diagrams with zoom</li>
        <li>Syntax highlighting</li>
        <li>LaTeX/KaTeX math</li>
        <li>Local and remote file viewing</li>
        <li>Live file updates</li>
        <li>Live preview editing with split view</li>
      </ul>
      <div class="dialog-actions">
        <button type="button" class="btn-primary" id="about-close">Close</button>
      </div>
    </dialog>

    <dialog id="settings-dialog" class="modal">
      <h3>Settings</h3>
      <div class="settings-section">
        <h4>Welcome Screen</h4>
        <div class="setting-row">
          <label for="show-docs">Show Docs Folder</label>
          <input type="checkbox" id="show-docs" checked>
        </div>
        <div class="setting-row">
          <label for="show-recent">Show Recent Files</label>
          <input type="checkbox" id="show-recent" checked>
        </div>
      </div>
      <div class="settings-section">
        <h4>Appearance</h4>
        <div class="setting-row">
          <label for="center-dialogs">Center Dialogs</label>
          <input type="checkbox" id="center-dialogs">
        </div>
      </div>
      <div class="dialog-actions">
        <button type="button" class="btn-primary" id="settings-close">Close</button>
      </div>
    </dialog>
  </div>

  <script type="module" src="./js/app.js"></script>
</body>
</html>
