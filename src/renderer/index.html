<!DOCTYPE html>
<html lang="en" data-theme="dark" style="background:#0d1117">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, viewport-fit=cover">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-eval'; img-src 'self' data: file: https:; font-src 'self' data:;">
  <title>MD Viewer</title>
  <link rel="stylesheet" href="./styles/main.css">
  <link rel="stylesheet" href="./styles/menu.css">
  <link rel="stylesheet" href="./styles/markdown.css">
  <link rel="stylesheet" href="./styles/mermaid.css">
  <link rel="stylesheet" href="./styles/dialogs.css">
  <link rel="stylesheet" href="./styles/editor.css">
  <link rel="stylesheet" href="./styles/mobile.css">
  <link rel="stylesheet" href="./styles/themes/dark.css">
</head>
<body>
  <!-- Menu Bar -->
  <nav id="menu-bar">
    <div class="menu-item">
      <button class="menu-button" aria-haspopup="true" aria-expanded="false">File</button>
      <ul class="menu-dropdown" role="menu">
        <li role="menuitem">
          <button id="menu-open-local" class="menu-action">
            <span>Open Local File</span>
            <span class="menu-shortcut">Ctrl+O</span>
          </button>
        </li>
        <li role="menuitem" class="electron-only">
          <button id="menu-open-remote" class="menu-action">
            <span>Open Remote File</span>
            <span class="menu-shortcut">Ctrl+Shift+O</span>
          </button>
        </li>
        <li role="separator" class="menu-separator"></li>
        <li role="menuitem">
          <button id="menu-reload" class="menu-action" disabled>
            <span>Reload</span>
            <span class="menu-shortcut">Ctrl+R</span>
          </button>
        </li>
        <li role="menuitem">
          <button id="menu-close" class="menu-action" disabled>
            <span>Close/Disconnect</span>
          </button>
        </li>
        <li role="separator" class="menu-separator"></li>
        <li role="menuitem">
          <button id="menu-settings" class="menu-action">
            <span>Settings</span>
          </button>
        </li>
      </ul>
    </div>
    <div class="menu-item">
      <button class="menu-button" aria-haspopup="true" aria-expanded="false">View</button>
      <ul class="menu-dropdown" role="menu">
        <li role="menuitem">
          <button id="menu-zoom-in" class="menu-action">
            <span>Zoom In</span>
            <span class="menu-shortcut">Ctrl++</span>
          </button>
        </li>
        <li role="menuitem">
          <button id="menu-zoom-out" class="menu-action">
            <span>Zoom Out</span>
            <span class="menu-shortcut">Ctrl+-</span>
          </button>
        </li>
        <li role="menuitem">
          <button id="menu-zoom-reset" class="menu-action">
            <span>Reset Zoom</span>
            <span class="menu-shortcut">Ctrl+0</span>
          </button>
        </li>
        <li role="separator" class="menu-separator"></li>
        <li role="menuitem">
          <button id="menu-toggle-theme" class="menu-action">
            <span>Toggle Theme</span>
            <span class="menu-shortcut">Ctrl+Shift+T</span>
          </button>
        </li>
        <li role="menuitem">
          <button id="menu-fullscreen" class="menu-action">
            <span>Toggle Fullscreen</span>
            <span class="menu-shortcut">F11</span>
          </button>
        </li>
      </ul>
    </div>
    <div class="menu-item">
      <button class="menu-button" aria-haspopup="true" aria-expanded="false">Help</button>
      <ul class="menu-dropdown" role="menu">
        <li role="menuitem">
          <button id="menu-shortcuts" class="menu-action">
            <span>Keyboard Shortcuts</span>
          </button>
        </li>
        <li role="menuitem">
          <button id="menu-about" class="menu-action">
            <span>About</span>
          </button>
        </li>
      </ul>
    </div>
  </nav>
  <!-- Hidden file input for web mode -->
  <input type="file" id="file-input" accept=".md,.markdown" style="display:none">

  <div id="app">
    <!-- Loading overlay -->
    <div id="loading-overlay" class="hidden">
      <div class="loading-spinner"></div>
      <p class="loading-message">Loading...</p>
    </div>

    <!-- Toast notifications -->
    <div id="toast-container"></div>

    <!-- Error banner -->
    <div id="error-banner" class="hidden">
      <span class="error-message"></span>
      <button class="error-dismiss" aria-label="Dismiss">&times;</button>
    </div>

    <!-- Connection status banner -->
    <div id="connection-banner" class="hidden">
      <span class="connection-message"></span>
      <button class="connection-retry">Retry</button>
      <button class="connection-dismiss" aria-label="Dismiss">&times;</button>
    </div>

    <!-- Empty state -->
    <div id="empty-state">
      <div class="empty-header">
        <div class="empty-icon">üìÑ</div>
        <h2>Drag a markdown file here</h2>
        <p id="shortcut-hint">or press <kbd>Ctrl</kbd>+<kbd>O</kbd> to open</p>
      </div>

      <div class="files-sections">
        <div class="docs-files" id="docs-section">
          <h3>Docs Folder</h3>
          <ul id="docs-files-list"></ul>
        </div>
        <div class="recent-files" id="recent-section">
          <h3>Recent Files</h3>
          <ul id="recent-files-list"></ul>
        </div>
      </div>
    </div>

    <!-- Main content -->
    <main id="content" class="hidden">
      <div class="editor-container">
        <!-- Mode tabs -->
        <div class="editor-tabs" role="tablist" aria-label="Editor modes">
          <button class="editor-tab active" id="tab-view" data-mode="view" role="tab" aria-selected="true" aria-controls="preview-pane">
            <span class="tab-icon" aria-hidden="true">üëÅ</span>
            <span>View</span>
          </button>
          <button class="editor-tab" id="tab-edit" data-mode="edit" role="tab" aria-selected="false" aria-controls="editor-pane">
            <span class="tab-icon" aria-hidden="true">‚úèÔ∏è</span>
            <span>Edit</span>
          </button>
          <div class="editor-tab-spacer"></div>
          <button class="split-toggle" id="split-toggle" title="Split View" aria-label="Toggle split view">
            <span aria-hidden="true">‚´ø</span>
            <span>Split</span>
          </button>
          <button class="save-btn hidden" id="save-btn" title="Save (Ctrl+S)" aria-label="Save file (Ctrl+S)">
            <span aria-hidden="true">üíæ</span>
            <span>Save</span>
          </button>
        </div>

        <!-- Formatting toolbar (visible in edit mode) -->
        <div class="editor-toolbar hidden" id="editor-toolbar" role="toolbar" aria-label="Formatting tools">
          <div class="toolbar-group" role="group" aria-label="Text formatting">
            <button class="toolbar-btn" id="fmt-bold" title="Bold (Ctrl+B)" aria-label="Bold (Ctrl+B)"><strong>B</strong></button>
            <button class="toolbar-btn" id="fmt-italic" title="Italic (Ctrl+I)" aria-label="Italic (Ctrl+I)"><em>I</em></button>
            <button class="toolbar-btn" id="fmt-strike" title="Strikethrough" aria-label="Strikethrough"><s>S</s></button>
          </div>
          <div class="toolbar-group" role="group" aria-label="Headings">
            <button class="toolbar-btn" id="fmt-h1" title="Heading 1" aria-label="Heading 1">H1</button>
            <button class="toolbar-btn" id="fmt-h2" title="Heading 2" aria-label="Heading 2">H2</button>
            <button class="toolbar-btn" id="fmt-h3" title="Heading 3" aria-label="Heading 3">H3</button>
          </div>
          <div class="toolbar-group" role="group" aria-label="Code">
            <button class="toolbar-btn" id="fmt-code" title="Inline Code" aria-label="Inline code">&lt;&gt;</button>
            <button class="toolbar-btn" id="fmt-codeblock" title="Code Block" aria-label="Code block">{ }</button>
          </div>
          <div class="toolbar-group" role="group" aria-label="Links and media">
            <button class="toolbar-btn" id="fmt-link" title="Link" aria-label="Insert link">üîó</button>
            <button class="toolbar-btn" id="fmt-image" title="Image" aria-label="Insert image">üñº</button>
          </div>
          <div class="toolbar-group" role="group" aria-label="Lists">
            <button class="toolbar-btn" id="fmt-bullet" title="Bullet List" aria-label="Bullet list">‚Ä¢</button>
            <button class="toolbar-btn" id="fmt-number" title="Numbered List" aria-label="Numbered list">1.</button>
            <button class="toolbar-btn" id="fmt-task" title="Task List" aria-label="Task list">‚òë</button>
          </div>
          <div class="toolbar-group" role="group" aria-label="Block elements">
            <button class="toolbar-btn" id="fmt-quote" title="Blockquote" aria-label="Blockquote">‚ùù</button>
            <button class="toolbar-btn" id="fmt-hr" title="Horizontal Rule" aria-label="Horizontal rule">‚Äî</button>
            <button class="toolbar-btn" id="fmt-table" title="Table" aria-label="Insert table">‚ñ¶</button>
          </div>
        </div>

        <!-- Editor content area -->
        <div class="editor-content" id="editor-content">
          <!-- Editor pane -->
          <div class="editor-pane hidden" id="editor-pane" role="tabpanel" aria-labelledby="tab-edit">
            <div class="editor-line-numbers" id="editor-line-numbers" aria-hidden="true"></div>
            <div class="editor-textarea-wrapper">
              <textarea 
                class="editor-textarea" 
                id="editor-textarea" 
                placeholder="Start writing markdown..."
                spellcheck="true"
                aria-label="Markdown editor"
              ></textarea>
            </div>
          </div>

          <!-- Split resizer -->
          <div class="split-resizer hidden" id="split-resizer" role="separator" aria-orientation="vertical" aria-label="Resize editor and preview panes"></div>

          <!-- Preview pane -->
          <div class="preview-pane" id="preview-pane" role="tabpanel" aria-labelledby="tab-view">
            <article id="markdown-content" class="preview-content"></article>
          </div>
        </div>

        <!-- Status bar -->
        <div class="editor-status-bar hidden" id="editor-status-bar">
          <span class="status-item" id="status-lines">Lines: 0</span>
          <span class="status-item" id="status-chars">Characters: 0</span>
          <span class="status-item status-saved" id="status-saved">‚úì Saved</span>
        </div>
      </div>
    </main>

    <!-- Dialogs -->
    <dialog id="remote-dialog" class="modal">
      <form method="dialog">
        <h3>Open Remote File</h3>
        <div class="form-row">
          <div class="form-group">
            <label for="remote-protocol">Protocol</label>
            <select id="remote-protocol">
              <option value="ssh">SSH/SFTP</option>
              <option value="smb">SMB/CIFS</option>
              <option value="nfs">NFS</option>
            </select>
          </div>
          <div class="form-group flex-grow">
            <label for="remote-host">Host</label>
            <input type="text" id="remote-host" placeholder="server.example.com" required>
          </div>
          <div class="form-group">
            <label for="remote-port">Port</label>
            <input type="number" id="remote-port" value="22" min="1" max="65535">
          </div>
        </div>
        <div class="form-group">
          <label for="remote-path">Path</label>
          <input type="text" id="remote-path" placeholder="/home/user/docs" required>
        </div>
        <div class="form-group" id="smb-share-group" style="display: none;">
          <label for="smb-share">Share Name</label>
          <input type="text" id="smb-share" placeholder="documents">
        </div>
        <div class="file-browser hidden" id="remote-file-browser">
          <div class="browser-toolbar">
            <button type="button" id="browser-up" class="icon-btn" title="Go up">‚¨Ü</button>
            <span id="browser-path">/</span>
            <button type="button" id="browser-refresh" class="icon-btn" title="Refresh">üîÑ</button>
          </div>
          <ul id="browser-list" class="file-list"></ul>
        </div>
        <div class="recent-connections" id="recent-connections">
          <h4>Recent Connections</h4>
          <ul id="recent-connections-list"></ul>
        </div>
        <div class="dialog-actions">
          <button type="button" class="btn-secondary" id="remote-cancel">Cancel</button>
          <button type="button" class="btn-secondary" id="remote-connect">Connect</button>
          <button type="submit" class="btn-primary" id="remote-open" disabled>Open</button>
        </div>
      </form>
    </dialog>

    <dialog id="credentials-dialog" class="modal">
      <form method="dialog">
        <h3>Authentication Required</h3>
        <p class="connection-info">
          Connect to <strong id="cred-host"></strong> via <span id="cred-protocol"></span>
        </p>
        <div class="form-group">
          <label for="cred-username">Username</label>
          <input type="text" id="cred-username" required autocomplete="username">
        </div>
        <div class="form-group">
          <label for="cred-password">Password</label>
          <input type="password" id="cred-password" autocomplete="current-password">
        </div>
        <div class="form-group" id="ssh-key-group" style="display: none;">
          <label for="cred-keyfile">SSH Private Key (optional)</label>
          <input type="file" id="cred-keyfile" accept=".pem,.ppk,.key,id_rsa,id_ed25519">
          <small>Leave empty to use password authentication</small>
        </div>
        <div class="form-group" id="smb-domain-group" style="display: none;">
          <label for="cred-domain">Domain</label>
          <input type="text" id="cred-domain" placeholder="WORKGROUP">
        </div>
        <div class="form-group checkbox">
          <input type="checkbox" id="cred-remember">
          <label for="cred-remember">Remember credentials (encrypted)</label>
        </div>
        <div class="dialog-actions">
          <button type="button" class="btn-secondary" id="cred-cancel">Cancel</button>
          <button type="submit" class="btn-primary">Connect</button>
        </div>
      </form>
    </dialog>

    <dialog id="shortcuts-dialog" class="modal">
      <h3>Keyboard Shortcuts</h3>
      <table class="shortcuts-table">
        <tbody>
          <tr id="shortcut-ctrl-o"><td><kbd>Ctrl</kbd>+<kbd>O</kbd></td><td>Open local file</td></tr>
          <tr><td><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>O</kbd></td><td>Open remote file</td></tr>
          <tr><td><kbd>Ctrl</kbd>+<kbd>S</kbd></td><td>Save file (in edit mode)</td></tr>
          <tr><td><kbd>Ctrl</kbd>+<kbd>R</kbd></td><td>Reload file</td></tr>
          <tr><td><kbd>Ctrl</kbd>+<kbd>W</kbd></td><td>Close window</td></tr>
          <tr><td><kbd>Ctrl</kbd>+<kbd>+</kbd></td><td>Zoom in</td></tr>
          <tr><td><kbd>Ctrl</kbd>+<kbd>-</kbd></td><td>Zoom out</td></tr>
          <tr><td><kbd>Ctrl</kbd>+<kbd>0</kbd></td><td>Reset zoom</td></tr>
          <tr><td><kbd>Ctrl</kbd>+<kbd>F</kbd></td><td>Find in document</td></tr>
          <tr><td><kbd>F11</kbd></td><td>Toggle fullscreen</td></tr>
          <tr id="shortcut-home"><td><kbd>Esc</kbd></td><td>Close dialog</td></tr>
        </tbody>
      </table>
      <h4 style="margin-top: 1rem; margin-bottom: 0.5rem;">Edit Mode Shortcuts</h4>
      <table class="shortcuts-table">
        <tbody>
          <tr><td><kbd>Ctrl</kbd>+<kbd>B</kbd></td><td>Bold</td></tr>
          <tr><td><kbd>Ctrl</kbd>+<kbd>I</kbd></td><td>Italic</td></tr>
          <tr><td><kbd>Ctrl</kbd>+<kbd>K</kbd></td><td>Insert link</td></tr>
        </tbody>
      </table>
      <div class="dialog-actions">
        <button type="button" class="btn-primary" id="shortcuts-close">Close</button>
      </div>
    </dialog>

    <dialog id="about-dialog" class="modal">
      <h3>MD Viewer</h3>
      <p>Version 1.0.0</p>
      <p>A minimalist markdown file viewer and editor with support for:</p>
      <ul>
        <li>GitHub Flavored Markdown</li>
        <li>Mermaid diagrams with zoom</li>
        <li>Syntax highlighting</li>
        <li>LaTeX/KaTeX math</li>
        <li>Local and remote file viewing</li>
        <li>Live file updates</li>
        <li>Live preview editing with split view</li>
      </ul>
      <div class="dialog-actions">
        <button type="button" class="btn-primary" id="about-close">Close</button>
      </div>
    </dialog>

    <dialog id="settings-dialog" class="modal">
      <h3>Settings</h3>
      <div class="settings-section">
        <h4>Welcome Screen</h4>
        <div class="setting-row">
          <label for="show-docs">Show Docs Folder</label>
          <input type="checkbox" id="show-docs" checked>
        </div>
        <div class="setting-row">
          <label for="show-recent">Show Recent Files</label>
          <input type="checkbox" id="show-recent" checked>
        </div>
      </div>
      <div class="settings-section">
        <h4>Appearance</h4>
        <div class="setting-row">
          <label for="center-dialogs">Center Dialogs</label>
          <input type="checkbox" id="center-dialogs">
        </div>
      </div>
      <div class="dialog-actions">
        <button type="button" class="btn-primary" id="settings-close">Close</button>
      </div>
    </dialog>
  </div>

  <script type="module" src="./js/app.js"></script>
</body>
</html>
